<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Set Up a Secure V2ray + Warp + Cloudflare Internet Access (Step-by-Step Guide) | LiftCtrl</title><meta name=keywords content><meta name=description content="This guide provides a step-by-step tutorial to deploy a V2ray + WebSocket + TLS + Cloudflare CDN + Warp setup. It&rsquo;s ideal for users in China seeking stable and secure global Internet access while preventing DNS pollution and hiding their VPS IP.
We’ll cover everything: VPS preparation, domain setup, Cloudflare configuration, TLS certificate, V2ray and Nginx setup, Warp integration, and client configuration."><meta name=author content="Xian Zhan Yang"><link rel=canonical href=https://liftctrl.github.io/posts/2025-01-how-to-secure-v2ray-warp-cloudflare/><link crossorigin=anonymous href=/assets/css/stylesheet.5695715c022bbb5d41ba4755a440a0cabb52ac3d3747a403e9e827e64777d9a2.css integrity="sha256-VpVxXAIru11BukdVpECgyrtSrD03R6QD6egn5kd32aI=" rel="preload stylesheet" as=style><link rel=icon href=https://liftctrl.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://liftctrl.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://liftctrl.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://liftctrl.github.io/apple-touch-icon.png><link rel=mask-icon href=https://liftctrl.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://liftctrl.github.io/posts/2025-01-how-to-secure-v2ray-warp-cloudflare/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://liftctrl.github.io/posts/2025-01-how-to-secure-v2ray-warp-cloudflare/"><meta property="og:site_name" content="LiftCtrl"><meta property="og:title" content="How to Set Up a Secure V2ray + Warp + Cloudflare Internet Access (Step-by-Step Guide)"><meta property="og:description" content="This guide provides a step-by-step tutorial to deploy a V2ray + WebSocket + TLS + Cloudflare CDN + Warp setup. It’s ideal for users in China seeking stable and secure global Internet access while preventing DNS pollution and hiding their VPS IP.
We’ll cover everything: VPS preparation, domain setup, Cloudflare configuration, TLS certificate, V2ray and Nginx setup, Warp integration, and client configuration."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-09T22:46:05+08:00"><meta property="article:modified_time" content="2025-10-09T22:46:05+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Set Up a Secure V2ray + Warp + Cloudflare Internet Access (Step-by-Step Guide)"><meta name=twitter:description content="This guide provides a step-by-step tutorial to deploy a V2ray + WebSocket + TLS + Cloudflare CDN + Warp setup. It&rsquo;s ideal for users in China seeking stable and secure global Internet access while preventing DNS pollution and hiding their VPS IP.
We’ll cover everything: VPS preparation, domain setup, Cloudflare configuration, TLS certificate, V2ray and Nginx setup, Warp integration, and client configuration."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://liftctrl.github.io/posts/"},{"@type":"ListItem","position":2,"name":"How to Set Up a Secure V2ray + Warp + Cloudflare Internet Access (Step-by-Step Guide)","item":"https://liftctrl.github.io/posts/2025-01-how-to-secure-v2ray-warp-cloudflare/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Set Up a Secure V2ray + Warp + Cloudflare Internet Access (Step-by-Step Guide)","name":"How to Set Up a Secure V2ray \u002b Warp \u002b Cloudflare Internet Access (Step-by-Step Guide)","description":"This guide provides a step-by-step tutorial to deploy a V2ray + WebSocket + TLS + Cloudflare CDN + Warp setup. It\u0026rsquo;s ideal for users in China seeking stable and secure global Internet access while preventing DNS pollution and hiding their VPS IP.\nWe’ll cover everything: VPS preparation, domain setup, Cloudflare configuration, TLS certificate, V2ray and Nginx setup, Warp integration, and client configuration.\n","keywords":[],"articleBody":"This guide provides a step-by-step tutorial to deploy a V2ray + WebSocket + TLS + Cloudflare CDN + Warp setup. It’s ideal for users in China seeking stable and secure global Internet access while preventing DNS pollution and hiding their VPS IP.\nWe’ll cover everything: VPS preparation, domain setup, Cloudflare configuration, TLS certificate, V2ray and Nginx setup, Warp integration, and client configuration.\nPreparations Before starting, make sure you have:\nSSH access to your VPS Installed client (v2rayN for Windows or v2rayNG for Android) Domain and Cloudflare credentials ready VPS Setup I’m using a RackNerd VPS in Los Angeles, but any offshore VPS works.\nRecommended environment:\nOS: Debian 11+ / Ubuntu 20.04+ CPU: 1 core or higher RAM: 1 GB minimum Ports: TCP 80 and 443 open Login to your VPS:\nssh root@your_vps_ip Domain Name (NameSilo) Purchase your domain from NameSilo Set Cloudflare nameservers in NameSilo’s DNS settings (provided by Cloudflare). In Cloudflare DNS: A Record Name: @ IPv4: Your VPS IP Proxy Status: Proxied (orange cloud) CNAME Record (optional) Name: www Target: yourdomain.com Proxy Status: Proxied Keep your VPS IP hidden behind Cloudflare proxy to avoid scanners and attacks.\nCloudflare Configuration SSL/TLS → Full (Strict) Enable Always Use HTTPS Enable HTTP/2 and HTTP/3 (Optional) Security → Enable Bot Fight Mode Create an API Token: Go to: Profile → API Tokens → Create Token Template: Edit zone DNS Scope: Your domain only Save your token for later use (in acme.sh step). Install Required Packages Update and install base packages:\nsudo apt update \u0026\u0026 sudo apt upgrade -y sudo apt install -y nginx curl socat uuid-runtime unzip fail2ban wireguard-tools Obtain TLS Certificate via acme.sh + Cloudflare Install acme.sh:\ncurl https://get.acme.sh | sh -s email=you@example.com source ~/.bashrc Set your Cloudflare API token:\nexport CF_Token=\"YOUR_CLOUDFLARE_API_TOKEN\" Issue a certificate using Cloudflare DNS:\nacme.sh --issue --dns dns_cf -d yourdomain.com --keylength ec-256 Install certificate and set up auto-renew:\nsudo mkdir -p /etc/nginx/ssl acme.sh --install-cert -d yourdomain.com \\ --key-file /etc/nginx/ssl/yourdomain.key \\ --fullchain-file /etc/nginx/ssl/yourdomain.crt \\ --reloadcmd \"sudo systemctl reload nginx\" Install and Enable V2ray Install the latest stable release:\nbash \u003c(curl -Ls https://github.com/v2fly/fhs-install-v2ray/raw/master/install-release.sh) Generate a UUID for your client:\nuuidgen Keep it safe — it will be used in both server and client configuration.\nConfigure V2ray (with Random WebSocket Path) Use a randomized path for stealth, e.g., /ws/8f3a7b2c9d.\nEdit V2ray config:\nsudo nano /usr/local/etc/v2ray/config.json Paste this configuration:\n{ \"log\": { \"loglevel\": \"warning\" }, \"dns\": { \"servers\": [\"1.1.1.1\",\"8.8.8.8\",\"8.8.4.4\"] }, \"inbounds\": [{ \"port\": 10000, \"listen\": \"127.0.0.1\", \"protocol\": \"vless\", \"settings\": { \"clients\": [{\"id\": \"YOUR_UUID\",\"flow\": \"\"}], \"decryption\": \"none\" }, \"streamSettings\": { \"network\": \"ws\", \"security\": \"none\", \"wsSettings\": { \"path\": \"/ws/8f3a7b2c9d\", \"headers\": { \"Host\": \"yourdomain.com\" } } } }], \"outbounds\": [ { \"tag\": \"warp-out\", \"protocol\": \"freedom\", \"settings\": {}, \"streamSettings\": { \"sockopt\": { \"interface\": \"wgcf\" } } }, { \"tag\": \"direct\", \"protocol\": \"freedom\", \"settings\": {} } ], \"routing\": { \"domainStrategy\": \"IPIfNonMatch\", \"rules\": [ { \"type\":\"field\",\"ip\":[\"geoip:cn\",\"geoip:private\"],\"outboundTag\":\"direct\" }, { \"type\":\"field\",\"domain\":[\"geosite:cn\"],\"outboundTag\":\"direct\" }, { \"type\":\"field\",\"network\":\"tcp,udp\",\"outboundTag\":\"warp-out\" } ] } } Save and exit.\nConfigure Nginx Reverse Proxy Rate Limiting Edit /etc/nginx/nginx.conf inside the http {} block:\nlimit_req_zone $binary_remote_addr zone=req_limit:10m rate=1r/s; burst allows short bursts beyond the rate limit. Adjust 1r/s to 5r/s if needed.\nSite Configuration Edit /etc/nginx/sites-available/default:\nserver { listen 443 ssl http2; server_name yourdomain.com; ssl_certificate /etc/nginx/ssl/yourdomain.crt; ssl_certificate_key /etc/nginx/ssl/yourdomain.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers HIGH:!aNULL:!MD5; location /ws/8f3a7b2c9d { proxy_pass http://127.0.0.1:10000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; limit_req zone=req_limit burst=10 nodelay; } location / { root /var/www/html; index index.html; } } server { listen 80; server_name yourdomain.com; return 301 https://$host$request_uri; } Reload Nginx:\nsudo systemctl reload nginx Configure Cloudflare Warp (WireGuard) Install WireGuard if not already installed:\nsudo apt install -y wireguard-tools Create configuration:\nsudo nano /etc/wireguard/wgcf.conf Example:\n[Interface] PrivateKey = YOUR_PRIVATE_KEY Address = 172.16.0.2/32 DNS = 1.1.1.1,8.8.8.8,8.8.4.4 MTU = 1420 PostUp = ip -4 rule add from YOUR_VPS_IP lookup main prio 18 PostDown = ip -4 rule delete from YOUR_VPS_IP lookup main prio 18 [Peer] PublicKey = YOUR_WARP_PUBLIC_KEY AllowedIPs = 0.0.0.0/0, ::/0 Endpoint = engage.cloudflareclient.com:2408 Start and enable Warp:\nsudo wg-quick up wgcf sudo systemctl enable wg-quick@wgcf sudo wg Ensure outbound routing works correctly after enabling Warp.\nStart and Enable All Services sudo systemctl restart v2ray sudo systemctl enable v2ray sudo systemctl restart nginx sudo systemctl enable nginx sudo systemctl restart wg-quick@wgcf sudo systemctl enable wg-quick@wgcf sudo systemctl enable fail2ban sudo systemctl start fail2ban Client Configuration (v2rayN / v2rayNG) Field Value Remark Address yourdomain.com Your VPS domain Port 443 Nginx TLS UUID YOUR_UUID Generated in the setup Encryption none (VLESS) TLS handled by Nginx Transport WebSocket WebSocket over TLS Path /ws/8f3a7b2c9d Randomized path TLS Enabled Must match server Host (SNI) yourdomain.com Server Name Indication VLESS Link Example:\nvless://YOUR_UUID@yourdomain.com:443?encryption=none\u0026security=tls\u0026type=ws\u0026host=yourdomain.com\u0026path=%2Fws%2F8f3a7b2c9d#VLESS-CDN %2F is URL-encoded / for WebSocket path.\nSecurity and Optimization Tips Use a random WebSocket path for stealth.\nKeep Nginx default site for cover traffic.\nAlways set Cloudflare SSL to Full (Strict).\nEnable Fail2Ban and rate limiting to block scanners.\nUpdate VPS and packages regularly:\nsudo apt update \u0026\u0026 sudo apt upgrade -y Set v2ray loglevel to warning to reduce I/O load.\nNever expose port 10000 directly to the Internet.\nReview Warp routing to ensure it does not interfere with VPS traffic.\n","wordCount":"853","inLanguage":"en","datePublished":"2025-10-09T22:46:05+08:00","dateModified":"2025-10-09T22:46:05+08:00","author":{"@type":"Person","name":"Xian Zhan Yang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://liftctrl.github.io/posts/2025-01-how-to-secure-v2ray-warp-cloudflare/"},"publisher":{"@type":"Organization","name":"LiftCtrl","logo":{"@type":"ImageObject","url":"https://liftctrl.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://liftctrl.github.io/ accesskey=h title="LiftCtrl (Alt + H)">LiftCtrl</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://liftctrl.github.io/ title=Home><span>Home</span></a></li><li><a href=https://liftctrl.github.io/posts/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">How to Set Up a Secure V2ray + Warp + Cloudflare Internet Access (Step-by-Step Guide)</h1><div class=post-meta><span title='2025-10-09 22:46:05 +0800 +0800'>October 9, 2025</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;·&nbsp;<span>Xian Zhan Yang</span></div></header><div class=post-content><p>This guide provides a <strong>step-by-step tutorial</strong> to deploy a <strong>V2ray + WebSocket + TLS + Cloudflare CDN + Warp</strong> setup. It&rsquo;s ideal for users in China seeking stable and secure global Internet access while preventing DNS pollution and hiding their VPS IP.</p><p>We’ll cover everything: VPS preparation, domain setup, Cloudflare configuration, TLS certificate, V2ray and Nginx setup, Warp integration, and client configuration.</p><hr><h2 id=preparations>Preparations<a hidden class=anchor aria-hidden=true href=#preparations>#</a></h2><p>Before starting, make sure you have:</p><ul><li>SSH access to your VPS</li><li>Installed client (v2rayN for Windows or v2rayNG for Android)</li><li>Domain and Cloudflare credentials ready</li></ul><h3 id=vps-setup>VPS Setup<a hidden class=anchor aria-hidden=true href=#vps-setup>#</a></h3><p>I’m using a <strong>RackNerd VPS</strong> in <strong>Los Angeles</strong>, but any offshore VPS works.</p><p><strong>Recommended environment:</strong></p><ul><li>OS: Debian 11+ / Ubuntu 20.04+</li><li>CPU: 1 core or higher</li><li>RAM: 1 GB minimum</li><li>Ports: TCP 80 and 443 open</li></ul><p>Login to your VPS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh root@your_vps_ip
</span></span></code></pre></div><h3 id=domain-name-namesilo>Domain Name (NameSilo)<a hidden class=anchor aria-hidden=true href=#domain-name-namesilo>#</a></h3><ol><li>Purchase your domain from <a href=https://www.namesilo.com/>NameSilo</a></li><li>Set Cloudflare nameservers in NameSilo’s DNS settings (provided by Cloudflare).</li><li>In Cloudflare DNS:<ul><li><strong>A Record</strong><ul><li>Name: <code>@</code></li><li>IPv4: Your VPS IP</li><li>Proxy Status: <strong>Proxied (orange cloud)</strong></li></ul></li><li><strong>CNAME Record</strong> (optional)<ul><li>Name: <code>www</code></li><li>Target: <code>yourdomain.com</code></li><li>Proxy Status: <strong>Proxied</strong></li></ul></li></ul></li></ol><blockquote><p>Keep your VPS IP hidden behind Cloudflare proxy to avoid scanners and attacks.</p></blockquote><h3 id=cloudflare-configuration>Cloudflare Configuration<a hidden class=anchor aria-hidden=true href=#cloudflare-configuration>#</a></h3><ol><li><strong>SSL/TLS</strong> → <strong>Full (Strict)</strong></li><li>Enable <strong>Always Use HTTPS</strong></li><li>Enable <strong>HTTP/2</strong> and <strong>HTTP/3</strong></li><li>(Optional) Security → Enable <strong>Bot Fight Mode</strong></li><li>Create an API <strong>Token</strong>:<ul><li>Go to: <strong>Profile</strong> → <strong>API Tokens</strong> → <strong>Create Token</strong></li><li>Template: <strong>Edit zone DNS</strong></li><li>Scope: Your domain only</li><li>Save your token for later use (in <code>acme.sh</code> step).</li></ul></li></ol><hr><h2 id=install-required-packages>Install Required Packages<a hidden class=anchor aria-hidden=true href=#install-required-packages>#</a></h2><p>Update and install base packages:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt upgrade -y
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo apt install -y nginx curl socat uuid-runtime unzip fail2ban wireguard-tools
</span></span></code></pre></div><hr><h2 id=obtain-tls-certificate-via-acmesh--cloudflare>Obtain TLS Certificate via acme.sh + Cloudflare<a hidden class=anchor aria-hidden=true href=#obtain-tls-certificate-via-acmesh--cloudflare>#</a></h2><p>Install acme.sh:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://get.acme.sh | sh -s email<span style=color:#f92672>=</span>you@example.com
</span></span><span style=display:flex><span>source ~/.bashrc
</span></span></code></pre></div><p>Set your Cloudflare API token:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>export CF_Token<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;YOUR_CLOUDFLARE_API_TOKEN&#34;</span>
</span></span></code></pre></div><p>Issue a certificate using Cloudflare DNS:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>acme.sh --issue --dns dns_cf -d yourdomain.com --keylength ec-256
</span></span></code></pre></div><p>Install certificate and set up auto-renew:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /etc/nginx/ssl
</span></span><span style=display:flex><span>acme.sh --install-cert -d yourdomain.com <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --key-file /etc/nginx/ssl/yourdomain.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --fullchain-file /etc/nginx/ssl/yourdomain.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --reloadcmd <span style=color:#e6db74>&#34;sudo systemctl reload nginx&#34;</span>
</span></span></code></pre></div><hr><h2 id=install-and-enable-v2ray>Install and Enable V2ray<a hidden class=anchor aria-hidden=true href=#install-and-enable-v2ray>#</a></h2><p>Install the latest stable release:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bash &lt;<span style=color:#f92672>(</span>curl -Ls https://github.com/v2fly/fhs-install-v2ray/raw/master/install-release.sh<span style=color:#f92672>)</span>
</span></span></code></pre></div><p>Generate a UUID for your client:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uuidgen
</span></span></code></pre></div><blockquote><p>Keep it safe — it will be used in both server and client configuration.</p></blockquote><hr><h2 id=configure-v2ray-with-random-websocket-path>Configure V2ray (with Random WebSocket Path)<a hidden class=anchor aria-hidden=true href=#configure-v2ray-with-random-websocket-path>#</a></h2><p>Use a randomized path for stealth, e.g., <code>/ws/8f3a7b2c9d</code>.</p><p>Edit V2ray config:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nano /usr/local/etc/v2ray/config.json
</span></span></code></pre></div><p>Paste this configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;log&#34;</span>: <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;loglevel&#34;</span>: <span style=color:#e6db74>&#34;warning&#34;</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;dns&#34;</span>: <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;servers&#34;</span>: <span style=color:#f92672>[</span><span style=color:#e6db74>&#34;1.1.1.1&#34;</span>,<span style=color:#e6db74>&#34;8.8.8.8&#34;</span>,<span style=color:#e6db74>&#34;8.8.4.4&#34;</span><span style=color:#f92672>]</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;inbounds&#34;</span>: <span style=color:#f92672>[{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;port&#34;</span>: 10000,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;listen&#34;</span>: <span style=color:#e6db74>&#34;127.0.0.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;vless&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;settings&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;clients&#34;</span>: <span style=color:#f92672>[{</span><span style=color:#e6db74>&#34;id&#34;</span>: <span style=color:#e6db74>&#34;YOUR_UUID&#34;</span>,<span style=color:#e6db74>&#34;flow&#34;</span>: <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>}]</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;decryption&#34;</span>: <span style=color:#e6db74>&#34;none&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;streamSettings&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;network&#34;</span>: <span style=color:#e6db74>&#34;ws&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;security&#34;</span>: <span style=color:#e6db74>&#34;none&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;wsSettings&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;path&#34;</span>: <span style=color:#e6db74>&#34;/ws/8f3a7b2c9d&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;headers&#34;</span>: <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;Host&#34;</span>: <span style=color:#e6db74>&#34;yourdomain.com&#34;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}]</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;outbounds&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;warp-out&#34;</span>, <span style=color:#e6db74>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;freedom&#34;</span>, <span style=color:#e6db74>&#34;settings&#34;</span>: <span style=color:#f92672>{}</span>, <span style=color:#e6db74>&#34;streamSettings&#34;</span>: <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;sockopt&#34;</span>: <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;interface&#34;</span>: <span style=color:#e6db74>&#34;wgcf&#34;</span> <span style=color:#f92672>}</span> <span style=color:#f92672>}</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;tag&#34;</span>: <span style=color:#e6db74>&#34;direct&#34;</span>, <span style=color:#e6db74>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;freedom&#34;</span>, <span style=color:#e6db74>&#34;settings&#34;</span>: <span style=color:#f92672>{}</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>]</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;routing&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;domainStrategy&#34;</span>: <span style=color:#e6db74>&#34;IPIfNonMatch&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;rules&#34;</span>: <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;field&#34;</span>,<span style=color:#e6db74>&#34;ip&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;geoip:cn&#34;</span>,<span style=color:#e6db74>&#34;geoip:private&#34;</span><span style=color:#f92672>]</span>,<span style=color:#e6db74>&#34;outboundTag&#34;</span>:<span style=color:#e6db74>&#34;direct&#34;</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;field&#34;</span>,<span style=color:#e6db74>&#34;domain&#34;</span>:<span style=color:#f92672>[</span><span style=color:#e6db74>&#34;geosite:cn&#34;</span><span style=color:#f92672>]</span>,<span style=color:#e6db74>&#34;outboundTag&#34;</span>:<span style=color:#e6db74>&#34;direct&#34;</span> <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>{</span> <span style=color:#e6db74>&#34;type&#34;</span>:<span style=color:#e6db74>&#34;field&#34;</span>,<span style=color:#e6db74>&#34;network&#34;</span>:<span style=color:#e6db74>&#34;tcp,udp&#34;</span>,<span style=color:#e6db74>&#34;outboundTag&#34;</span>:<span style=color:#e6db74>&#34;warp-out&#34;</span> <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Save and exit.</p><hr><h2 id=configure-nginx-reverse-proxy>Configure Nginx Reverse Proxy<a hidden class=anchor aria-hidden=true href=#configure-nginx-reverse-proxy>#</a></h2><h3 id=rate-limiting>Rate Limiting<a hidden class=anchor aria-hidden=true href=#rate-limiting>#</a></h3><p>Edit <code>/etc/nginx/nginx.conf</code> <strong>inside the <code>http {}</code> block</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>limit_req_zone</span> $binary_remote_addr <span style=color:#e6db74>zone=req_limit:10m</span> <span style=color:#e6db74>rate=1r/s</span>;
</span></span></code></pre></div><blockquote><p><code>burst</code> allows short bursts beyond the rate limit. Adjust <code>1r/s</code> to <code>5r/s</code> if needed.</p></blockquote><h3 id=site-configuration>Site Configuration<a hidden class=anchor aria-hidden=true href=#site-configuration>#</a></h3><p>Edit <code>/etc/nginx/sites-available/default</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>yourdomain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/nginx/ssl/yourdomain.crt</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/nginx/ssl/yourdomain.key</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_protocols</span> <span style=color:#e6db74>TLSv1.2</span> <span style=color:#e6db74>TLSv1.3</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span> <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/ws/8f3a7b2c9d</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:10000</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;upgrade&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-Proto</span> $scheme;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>limit_req</span> <span style=color:#e6db74>zone=req_limit</span> <span style=color:#e6db74>burst=10</span> <span style=color:#e6db74>nodelay</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/html</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>yourdomain.com</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Reload Nginx:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl reload nginx
</span></span></code></pre></div><hr><h2 id=configure-cloudflare-warp-wireguard>Configure Cloudflare Warp (WireGuard)<a hidden class=anchor aria-hidden=true href=#configure-cloudflare-warp-wireguard>#</a></h2><p>Install WireGuard if not already installed:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y wireguard-tools
</span></span></code></pre></div><p>Create configuration:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nano /etc/wireguard/wgcf.conf
</span></span></code></pre></div><p>Example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>Interface<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>PrivateKey <span style=color:#f92672>=</span> YOUR_PRIVATE_KEY
</span></span><span style=display:flex><span>Address <span style=color:#f92672>=</span> 172.16.0.2/32
</span></span><span style=display:flex><span>DNS <span style=color:#f92672>=</span> 1.1.1.1,8.8.8.8,8.8.4.4
</span></span><span style=display:flex><span>MTU <span style=color:#f92672>=</span> <span style=color:#ae81ff>1420</span>
</span></span><span style=display:flex><span>PostUp <span style=color:#f92672>=</span> ip -4 rule add from YOUR_VPS_IP lookup main prio <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>PostDown <span style=color:#f92672>=</span> ip -4 rule delete from YOUR_VPS_IP lookup main prio <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Peer<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>PublicKey <span style=color:#f92672>=</span> YOUR_WARP_PUBLIC_KEY
</span></span><span style=display:flex><span>AllowedIPs <span style=color:#f92672>=</span> 0.0.0.0/0, ::/0
</span></span><span style=display:flex><span>Endpoint <span style=color:#f92672>=</span> engage.cloudflareclient.com:2408
</span></span></code></pre></div><p>Start and enable Warp:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo wg-quick up wgcf
</span></span><span style=display:flex><span>sudo systemctl enable wg-quick@wgcf
</span></span><span style=display:flex><span>sudo wg
</span></span></code></pre></div><blockquote><p>Ensure outbound routing works correctly after enabling Warp.</p></blockquote><hr><h2 id=start-and-enable-all-services>Start and Enable All Services<a hidden class=anchor aria-hidden=true href=#start-and-enable-all-services>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart v2ray
</span></span><span style=display:flex><span>sudo systemctl enable v2ray
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo systemctl restart nginx
</span></span><span style=display:flex><span>sudo systemctl enable nginx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo systemctl restart wg-quick@wgcf
</span></span><span style=display:flex><span>sudo systemctl enable wg-quick@wgcf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo systemctl enable fail2ban
</span></span><span style=display:flex><span>sudo systemctl start fail2ban
</span></span></code></pre></div><hr><h2 id=client-configuration-v2rayn--v2rayng>Client Configuration (v2rayN / v2rayNG)<a hidden class=anchor aria-hidden=true href=#client-configuration-v2rayn--v2rayng>#</a></h2><table><thead><tr><th>Field</th><th>Value</th><th>Remark</th></tr></thead><tbody><tr><td>Address</td><td>yourdomain.com</td><td>Your VPS domain</td></tr><tr><td>Port</td><td>443</td><td>Nginx TLS</td></tr><tr><td>UUID</td><td>YOUR_UUID</td><td>Generated in the setup</td></tr><tr><td>Encryption</td><td>none (VLESS)</td><td>TLS handled by Nginx</td></tr><tr><td>Transport</td><td>WebSocket</td><td>WebSocket over TLS</td></tr><tr><td>Path</td><td><code>/ws/8f3a7b2c9d</code></td><td>Randomized path</td></tr><tr><td>TLS</td><td>Enabled</td><td>Must match server</td></tr><tr><td>Host (SNI)</td><td>yourdomain.com</td><td>Server Name Indication</td></tr></tbody></table><p><strong>VLESS Link Example</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vless://YOUR_UUID@yourdomain.com:443?encryption<span style=color:#f92672>=</span>none&amp;security<span style=color:#f92672>=</span>tls&amp;type<span style=color:#f92672>=</span>ws&amp;host<span style=color:#f92672>=</span>yourdomain.com&amp;path<span style=color:#f92672>=</span>%2Fws%2F8f3a7b2c9d#VLESS-CDN
</span></span></code></pre></div><blockquote><p><code>%2F</code> is URL-encoded <code>/</code> for WebSocket path.</p></blockquote><hr><h2 id=security-and-optimization-tips>Security and Optimization Tips<a hidden class=anchor aria-hidden=true href=#security-and-optimization-tips>#</a></h2><ol><li><p>Use a <strong>random WebSocket path</strong> for stealth.</p></li><li><p>Keep <strong>Nginx default site</strong> for cover traffic.</p></li><li><p>Always set <strong>Cloudflare SSL to Full (Strict)</strong>.</p></li><li><p>Enable <strong>Fail2Ban</strong> and <strong>rate limiting</strong> to block scanners.</p></li><li><p>Update VPS and packages regularly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt upgrade -y
</span></span></code></pre></div></li><li><p>Set v2ray <code>loglevel</code> to <code>warning</code> to reduce I/O load.</p></li><li><p>Never expose port <code>10000</code> directly to the Internet.</p></li><li><p>Review Warp routing to ensure it does not interfere with VPS traffic.</p></li></ol><hr></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://liftctrl.github.io/posts/2025-10-09-how-to-set-up-v2ray-server/><span class=title>Next »</span><br><span>How to Set Up V2ray Server</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://liftctrl.github.io/>LiftCtrl</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>