<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to Set Up V2ray Server | LiftCtrl</title><meta name=keywords content><meta name=description content="This guide explains how to deploy V2ray + WebSocket + TLS + Cloudflare CDN + Warp, suitable for users in China who want stable, encrypted international internet access while hiding their VPS IP.

1. Preparation
1.1 VPS
For this guide, we use a RackNerd VPS located in Los Angeles, though any offshore VPS works.
Recommended system environment:

OS: Debian 11+ or Ubuntu 20.04+
CPU: 1 core or higher
RAM: at least 1 GB
Ensure TCP ports 80 and 443 are open

Connect to your VPS and update the system:"><meta name=author content="Xian Zhan Yang"><link rel=canonical href=https://liftctrl.github.io/posts/2025-10-09-how-to-set-up-v2ray-server/><link crossorigin=anonymous href=/assets/css/stylesheet.5695715c022bbb5d41ba4755a440a0cabb52ac3d3747a403e9e827e64777d9a2.css integrity="sha256-VpVxXAIru11BukdVpECgyrtSrD03R6QD6egn5kd32aI=" rel="preload stylesheet" as=style><link rel=icon href=https://liftctrl.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://liftctrl.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://liftctrl.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://liftctrl.github.io/apple-touch-icon.png><link rel=mask-icon href=https://liftctrl.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://liftctrl.github.io/posts/2025-10-09-how-to-set-up-v2ray-server/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://liftctrl.github.io/posts/2025-10-09-how-to-set-up-v2ray-server/"><meta property="og:site_name" content="LiftCtrl"><meta property="og:title" content="How to Set Up V2ray Server"><meta property="og:description" content="This guide explains how to deploy V2ray + WebSocket + TLS + Cloudflare CDN + Warp, suitable for users in China who want stable, encrypted international internet access while hiding their VPS IP.
1. Preparation 1.1 VPS For this guide, we use a RackNerd VPS located in Los Angeles, though any offshore VPS works.
Recommended system environment:
OS: Debian 11+ or Ubuntu 20.04+ CPU: 1 core or higher RAM: at least 1 GB Ensure TCP ports 80 and 443 are open Connect to your VPS and update the system:"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-10-09T22:46:05+08:00"><meta property="article:modified_time" content="2025-10-09T22:46:05+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to Set Up V2ray Server"><meta name=twitter:description content="This guide explains how to deploy V2ray + WebSocket + TLS + Cloudflare CDN + Warp, suitable for users in China who want stable, encrypted international internet access while hiding their VPS IP.

1. Preparation
1.1 VPS
For this guide, we use a RackNerd VPS located in Los Angeles, though any offshore VPS works.
Recommended system environment:

OS: Debian 11+ or Ubuntu 20.04+
CPU: 1 core or higher
RAM: at least 1 GB
Ensure TCP ports 80 and 443 are open

Connect to your VPS and update the system:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://liftctrl.github.io/posts/"},{"@type":"ListItem","position":2,"name":"How to Set Up V2ray Server","item":"https://liftctrl.github.io/posts/2025-10-09-how-to-set-up-v2ray-server/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to Set Up V2ray Server","name":"How to Set Up V2ray Server","description":"This guide explains how to deploy V2ray + WebSocket + TLS + Cloudflare CDN + Warp, suitable for users in China who want stable, encrypted international internet access while hiding their VPS IP.\n1. Preparation 1.1 VPS For this guide, we use a RackNerd VPS located in Los Angeles, though any offshore VPS works.\nRecommended system environment:\nOS: Debian 11+ or Ubuntu 20.04+ CPU: 1 core or higher RAM: at least 1 GB Ensure TCP ports 80 and 443 are open Connect to your VPS and update the system:\n","keywords":[],"articleBody":"This guide explains how to deploy V2ray + WebSocket + TLS + Cloudflare CDN + Warp, suitable for users in China who want stable, encrypted international internet access while hiding their VPS IP.\n1. Preparation 1.1 VPS For this guide, we use a RackNerd VPS located in Los Angeles, though any offshore VPS works.\nRecommended system environment:\nOS: Debian 11+ or Ubuntu 20.04+ CPU: 1 core or higher RAM: at least 1 GB Ensure TCP ports 80 and 443 are open Connect to your VPS and update the system:\nssh root@your_vps_ip sudo apt update \u0026\u0026 sudo apt upgrade -y Install required dependencies for all modules:\nsudo apt install -y curl socat uuid-runtime unzip üí° Tips :\nDifferent VPS providers may have minor variations; always check OS version and resource availability. Ensure SSH port is accessible and firewall rules allow TCP ports 80 and 443. Confirm your VPS IP and region before proceeding. Keep your root login secure and consider setting up a non-root user for future operations. 1.2 Domain Purchase your domain from NameSilo Set Cloudflare nameservers in NameSilo‚Äôs DNS settings (provided by Cloudflare). In Cloudflare DNS: A Record Name: @ IPv4: Your VPS IP Proxy Status: Proxied (orange cloud) CNAME Record (optional) Name: www Target: yourdomain.com Proxy Status: Proxied üí° Tip : Keep your VPS IP hidden behind Cloudflare proxy to avoid scanners and attacks.\n1.3 Cloudflare SSL/TLS ‚Üí Full (Strict) Enable Always Use HTTPS Enable HTTP/2 and HTTP/3 (Optional) Security ‚Üí Enable Bot Fight Mode Create an API Token: Go to: Profile ‚Üí API Tokens ‚Üí Create Token Template: Edit zone DNS Scope: Your domain only Save your token for later use (in acme.sh step). 2. Nginx Module 2.1 Install Nginx sudo apt install -y nginx 2.2 Generate TLS Certificate (acme.sh + Cloudflare) curl https://get.acme.sh | sh -s email=you@example.com source ~/.bashrc export CF_Token=\"YOUR_CLOUDFLARE_API_TOKEN\" acme.sh --issue --dns dns_cf -d yourdomain.com --keylength ec-256 sudo mkdir -p /etc/nginx/ssl acme.sh --install-cert -d yourdomain.com \\ --key-file /etc/nginx/ssl/yourdomain.key \\ --fullchain-file /etc/nginx/ssl/yourdomain.crt \\ --reloadcmd \"sudo systemctl reload nginx\" 2.3 Configure Nginx server { listen 443 ssl http2; server_name yourdomain.com; ssl_certificate /etc/nginx/ssl/yourdomain.crt; ssl_certificate_key /etc/nginx/ssl/yourdomain.key; ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers HIGH:!aNULL:!MD5; location /ws/8f3a7b2c9d { proxy_pass http://127.0.0.1:10000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection \"upgrade\"; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; limit_req zone=req_limit burst=10 nodelay; } location / { root /var/www/html; index index.html; } } server { listen 80; server_name yourdomain.com; return 301 https://$host$request_uri; } üí° Tip : Add rate limiting in the http {} block:\nlimit_req_zone $binary_remote_addr zone=req_limit:10m rate=1r/s; 3. V2ray Module 3.1 Install V2ray bash \u003c(curl -Ls https://github.com/v2fly/fhs-install-v2ray/raw/master/install-release.sh) 3.2 Generate UUID uuidgen 3.3 Configure V2ray Edit /usr/local/etc/v2ray/config.json Set a random WebSocket path, e.g., /ws/8f3a7b2c9d Make sure UUID matches the client configuration ‚ö†Ô∏è Note : Do not expose port 10000 directly to the internet.\n4. Warp Module 4.1 Install WireGuard (required for Warp) sudo apt install -y wireguard-tools 4.2 Configure Warp Edit /etc/wireguard/wgcf.conf Set PrivateKey, PublicKey, AllowedIPs, Endpoint, etc. [Interface] PrivateKey = YOUR_PRIVATE_KEY Address = 172.16.0.2/32 DNS = 1.1.1.1,8.8.8.8,8.8.4.4 MTU = 1420 PostUp = ip -4 rule add from YOUR_VPS_IP lookup main prio 18 PostDown = ip -4 rule delete from YOUR_VPS_IP lookup main prio 18 [Peer] PublicKey = YOUR_WARP_PUBLIC_KEY AllowedIPs = 0.0.0.0/0, ::/0 Endpoint = engage.cloudflareclient.com:2408 4.3 Start Warp sudo wg-quick up wgcf sudo systemctl enable wg-quick@wgcf sudo wg üí° Tip : Ensure VPS traffic routing works properly after enabling Warp.\n5. Fail2Ban Module 5.1 Install Fail2Ban sudo apt install -y fail2ban 5.2 Enable and Start sudo systemctl enable fail2ban sudo systemctl start fail2ban üí° Tip : Combine with Nginx rate limiting for extra security.\n6. Client Configuration (v2rayN / v2rayNG) Field Value Remark Address yourdomain.com Your VPS domain Port 443 Nginx TLS UUID YOUR_UUID Generated in the setup Encryption none (VLESS) TLS handled by Nginx Transport WebSocket WebSocket over TLS Path /ws/8f3a7b2c9d Randomized path TLS Enabled Must match server Host (SNI) yourdomain.com Server Name Indication VLESS Link Example:\nvless://YOUR_UUID@yourdomain.com:443?encryption=none\u0026security=tls\u0026type=ws\u0026host=yourdomain.com\u0026path=%2Fws%2F8f3a7b2c9d#VLESS-CDN üí° Tip : %2F is URL-encoded / for WebSocket path.\n7. Security and Optimization Tips Use a random WebSocket path for stealth. Keep Nginx default site for cover traffic. Always set Cloudflare SSL to Full (Strict). Enable Fail2Ban and rate limiting to block scanners. Regularly update VPS and packages: sudo apt update \u0026\u0026 sudo apt upgrade -y Set v2ray loglevel to warning to reduce I/O load. Never expose port 10000 directly to the Internet. Review Warp routing to ensure it does not interfere with VPS traffic. 8. Backup \u0026 Rollback Before making any major configuration changes, always back up your existing files.\nThis ensures you can restore your setup quickly if something goes wrong.\n8.1 Backup Important Configurations sudo mkdir -p /root/backup/v2ray sudo mkdir -p /root/backup/nginx sudo mkdir -p /root/backup/wireguard sudo cp /usr/local/etc/v2ray/config.json /root/backup/v2ray/config.json.bak sudo cp /etc/nginx/sites-available/default /root/backup/nginx/default.bak sudo cp /etc/wireguard/wgcf.conf /root/backup/wireguard/wgcf.conf.bak üí° Tip : You can also back up certificates and keys:\nsudo cp -r /etc/nginx/ssl /root/backup/nginx-ssl/ 8.2 Restore from Backup If configuration errors occur, you can restore quickly:\nsudo cp /root/backup/v2ray/config.json.bak /usr/local/etc/v2ray/config.json sudo cp /root/backup/nginx/default.bak /etc/nginx/sites-available/default sudo cp /root/backup/wireguard/wgcf.conf.bak /etc/wireguard/wgcf.conf sudo systemctl restart nginx sudo systemctl restart v2ray sudo systemctl restart wg-quick@wgcf üí° Tip : Always restart related services after restoring configuration files.\n9. Troubleshooting Even with a perfect setup, issues may occur. Here are common problems and how to fix them.\n9.1 V2ray Not Starting Check V2ray service status:\nsudo systemctl status v2ray If errors appear, check logs:\nsudo journalctl -u v2ray --no-pager -n 50 Common causes:\nInvalid JSON format in config.json Wrong UUID or path mismatch Nginx proxy port not matching V2ray inbound 9.2 Nginx Fails to Reload sudo nginx -t If syntax errors exist, fix them before restarting:\nsudo systemctl reload nginx 9.3 TLS Certificate Errors Check certificate paths in Nginx:\n/etc/nginx/ssl/yourdomain.crt /etc/nginx/ssl/yourdomain.key If expired or missing, reissue with acme.sh:\nacme.sh --renew -d yourdomain.com --force sudo systemctl reload nginx 9.4 Warp (WireGuard) Connectivity Issues Check WireGuard status:\nsudo wg sudo systemctl status wg-quick@wgcf If traffic does not route properly:\nVerify AllowedIPs include 0.0.0.0/0, ::/0 Ensure correct endpoint: engage.cloudflareclient.com:2408 Restart Warp: sudo wg-quick down wgcf sudo wg-quick up wgcf 9.5 Cloudflare Configuration Errors If HTTPS or CDN is not working:\nConfirm DNS proxy (orange cloud) is enabled. SSL/TLS mode must be Full (Strict). Ensure Nginx is serving port 443 correctly. Use curl -Iv https://yourdomain.com to check SSL response. 9.6 Client Connection Fails Verify your WebSocket path /ws/xxxxxx matches the server config. Ensure VLESS link matches UUID and domain. Test using direct IP to rule out DNS issues. Disable CDN temporarily to debug connectivity. üí° Tip : Always check logs in both V2ray server and Nginx for real-time clues.\n","wordCount":"1091","inLanguage":"en","datePublished":"2025-10-09T22:46:05+08:00","dateModified":"2025-10-09T22:46:05+08:00","author":{"@type":"Person","name":"Xian Zhan Yang"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://liftctrl.github.io/posts/2025-10-09-how-to-set-up-v2ray-server/"},"publisher":{"@type":"Organization","name":"LiftCtrl","logo":{"@type":"ImageObject","url":"https://liftctrl.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://liftctrl.github.io/ accesskey=h title="LiftCtrl (Alt + H)">LiftCtrl</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://liftctrl.github.io/ title=Home><span>Home</span></a></li><li><a href=https://liftctrl.github.io/posts/ title=Posts><span>Posts</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">How to Set Up V2ray Server</h1><div class=post-meta><span title='2025-10-09 22:46:05 +0800 +0800'>October 9, 2025</span>&nbsp;¬∑&nbsp;<span>6 min</span>&nbsp;¬∑&nbsp;<span>Xian Zhan Yang</span></div></header><div class=post-content><p>This guide explains how to deploy <strong>V2ray + WebSocket + TLS + Cloudflare CDN + Warp</strong>, suitable for users in China who want stable, encrypted international internet access while hiding their VPS IP.</p><hr><h2 id=1-preparation>1. Preparation<a hidden class=anchor aria-hidden=true href=#1-preparation>#</a></h2><h3 id=11-vps>1.1 VPS<a hidden class=anchor aria-hidden=true href=#11-vps>#</a></h3><p>For this guide, we use a <strong>RackNerd VPS</strong> located in <strong>Los Angeles</strong>, though any offshore VPS works.</p><p><strong>Recommended system environment:</strong></p><ul><li>OS: Debian 11+ or Ubuntu 20.04+</li><li>CPU: 1 core or higher</li><li>RAM: at least 1 GB</li><li>Ensure TCP ports <strong>80</strong> and <strong>443</strong> are open</li></ul><p><strong>Connect to your VPS and update the system:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh root@your_vps_ip
</span></span><span style=display:flex><span>sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt upgrade -y
</span></span></code></pre></div><p><strong>Install required dependencies for all modules:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y curl socat uuid-runtime unzip
</span></span></code></pre></div><blockquote><p>üí° Tips :</p><ul><li>Different VPS providers may have minor variations; always check OS version and resource availability.</li><li>Ensure SSH port is accessible and firewall rules allow TCP ports 80 and 443.</li><li>Confirm your VPS IP and region before proceeding.</li><li>Keep your root login secure and consider setting up a non-root user for future operations.</li></ul></blockquote><h3 id=12-domain>1.2 Domain<a hidden class=anchor aria-hidden=true href=#12-domain>#</a></h3><ol><li>Purchase your domain from NameSilo</li><li>Set Cloudflare nameservers in NameSilo‚Äôs DNS settings (provided by Cloudflare).</li><li>In Cloudflare DNS:<ul><li><strong>A Record</strong><ul><li>Name: <code>@</code></li><li>IPv4: Your VPS IP</li><li>Proxy Status: <strong>Proxied (orange cloud)</strong></li></ul></li><li><strong>CNAME Record</strong> (optional)<ul><li>Name: <code>www</code></li><li>Target: <code>yourdomain.com</code></li><li>Proxy Status: <strong>Proxied</strong></li></ul></li></ul></li></ol><blockquote><p>üí° Tip : Keep your VPS IP hidden behind Cloudflare proxy to avoid scanners and attacks.</p></blockquote><h3 id=13-cloudflare>1.3 Cloudflare<a hidden class=anchor aria-hidden=true href=#13-cloudflare>#</a></h3><ol><li><strong>SSL/TLS</strong> ‚Üí <strong>Full (Strict)</strong></li><li>Enable <strong>Always Use HTTPS</strong></li><li>Enable <strong>HTTP/2</strong> and <strong>HTTP/3</strong></li><li>(Optional) Security ‚Üí Enable <strong>Bot Fight Mode</strong></li><li>Create an API Token:<ul><li>Go to: <strong>Profile</strong> ‚Üí <strong>API Tokens</strong> ‚Üí <strong>Create Token</strong></li><li>Template: <strong>Edit zone DNS</strong></li><li>Scope: Your domain only</li><li>Save your token for later use (in <code>acme.sh</code> step).</li></ul></li></ol><hr><h2 id=2-nginx-module>2. Nginx Module<a hidden class=anchor aria-hidden=true href=#2-nginx-module>#</a></h2><h3 id=21-install-nginx>2.1 Install Nginx<a hidden class=anchor aria-hidden=true href=#21-install-nginx>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y nginx
</span></span></code></pre></div><h3 id=22-generate-tls-certificate-acmesh--cloudflare>2.2 Generate TLS Certificate (acme.sh + Cloudflare)<a hidden class=anchor aria-hidden=true href=#22-generate-tls-certificate-acmesh--cloudflare>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl https://get.acme.sh | sh -s email<span style=color:#f92672>=</span>you@example.com
</span></span><span style=display:flex><span>source ~/.bashrc
</span></span><span style=display:flex><span>export CF_Token<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;YOUR_CLOUDFLARE_API_TOKEN&#34;</span>
</span></span><span style=display:flex><span>acme.sh --issue --dns dns_cf -d yourdomain.com --keylength ec-256
</span></span><span style=display:flex><span>sudo mkdir -p /etc/nginx/ssl
</span></span><span style=display:flex><span>acme.sh --install-cert -d yourdomain.com <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --key-file /etc/nginx/ssl/yourdomain.key <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --fullchain-file /etc/nginx/ssl/yourdomain.crt <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --reloadcmd <span style=color:#e6db74>&#34;sudo systemctl reload nginx&#34;</span>
</span></span></code></pre></div><h3 id=23-configure-nginx>2.3 Configure Nginx<a hidden class=anchor aria-hidden=true href=#23-configure-nginx>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>443</span> <span style=color:#e6db74>ssl</span> <span style=color:#e6db74>http2</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>yourdomain.com</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate</span> <span style=color:#e6db74>/etc/nginx/ssl/yourdomain.crt</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_certificate_key</span> <span style=color:#e6db74>/etc/nginx/ssl/yourdomain.key</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_protocols</span> <span style=color:#e6db74>TLSv1.2</span> <span style=color:#e6db74>TLSv1.3</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>ssl_ciphers</span> <span style=color:#e6db74>HIGH:!aNULL:!MD5</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/ws/8f3a7b2c9d</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_pass</span> <span style=color:#e6db74>http://127.0.0.1:10000</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_http_version</span> <span style=color:#ae81ff>1</span><span style=color:#e6db74>.1</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Upgrade</span> $http_upgrade;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Connection</span> <span style=color:#e6db74>&#34;upgrade&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>Host</span> $host;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Real-IP</span> $remote_addr;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-For</span> $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        <span style=color:#f92672>proxy_set_header</span> <span style=color:#e6db74>X-Forwarded-Proto</span> $scheme;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>limit_req</span> <span style=color:#e6db74>zone=req_limit</span> <span style=color:#e6db74>burst=10</span> <span style=color:#e6db74>nodelay</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>location</span> <span style=color:#e6db74>/</span> {
</span></span><span style=display:flex><span>        <span style=color:#f92672>root</span> <span style=color:#e6db74>/var/www/html</span>;
</span></span><span style=display:flex><span>        <span style=color:#f92672>index</span> <span style=color:#e6db74>index.html</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>server</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>listen</span> <span style=color:#ae81ff>80</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>server_name</span> <span style=color:#e6db74>yourdomain.com</span>;
</span></span><span style=display:flex><span>    <span style=color:#f92672>return</span> <span style=color:#ae81ff>301</span> <span style=color:#e6db74>https://</span>$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><blockquote><p>üí° Tip : Add rate limiting in the <code>http {}</code> block:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#66d9ef>limit_req_zone</span> $binary_remote_addr <span style=color:#e6db74>zone=req_limit:10m</span> <span style=color:#e6db74>rate=1r/s</span>;
</span></span></code></pre></div><hr><h2 id=3-v2ray-module>3. V2ray Module<a hidden class=anchor aria-hidden=true href=#3-v2ray-module>#</a></h2><h3 id=31-install-v2ray>3.1 Install V2ray<a hidden class=anchor aria-hidden=true href=#31-install-v2ray>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>bash &lt;<span style=color:#f92672>(</span>curl -Ls https://github.com/v2fly/fhs-install-v2ray/raw/master/install-release.sh<span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=32-generate-uuid>3.2 Generate UUID<a hidden class=anchor aria-hidden=true href=#32-generate-uuid>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>uuidgen
</span></span></code></pre></div><h3 id=33-configure-v2ray>3.3 Configure V2ray<a hidden class=anchor aria-hidden=true href=#33-configure-v2ray>#</a></h3><ul><li>Edit <code>/usr/local/etc/v2ray/config.json</code></li><li>Set a random WebSocket path, e.g., <code>/ws/8f3a7b2c9d</code></li><li>Make sure UUID matches the client configuration</li></ul><blockquote><p>‚ö†Ô∏è Note : Do not expose port 10000 directly to the internet.</p></blockquote><hr><h2 id=4-warp-module>4. Warp Module<a hidden class=anchor aria-hidden=true href=#4-warp-module>#</a></h2><h3 id=41-install-wireguard-required-for-warp>4.1 Install WireGuard (required for Warp)<a hidden class=anchor aria-hidden=true href=#41-install-wireguard-required-for-warp>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y wireguard-tools
</span></span></code></pre></div><h3 id=42-configure-warp>4.2 Configure Warp<a hidden class=anchor aria-hidden=true href=#42-configure-warp>#</a></h3><ul><li>Edit <code>/etc/wireguard/wgcf.conf</code></li><li>Set PrivateKey, PublicKey, AllowedIPs, Endpoint, etc.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>Interface<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>PrivateKey <span style=color:#f92672>=</span> YOUR_PRIVATE_KEY
</span></span><span style=display:flex><span>Address <span style=color:#f92672>=</span> 172.16.0.2/32
</span></span><span style=display:flex><span>DNS <span style=color:#f92672>=</span> 1.1.1.1,8.8.8.8,8.8.4.4
</span></span><span style=display:flex><span>MTU <span style=color:#f92672>=</span> <span style=color:#ae81ff>1420</span>
</span></span><span style=display:flex><span>PostUp <span style=color:#f92672>=</span> ip -4 rule add from YOUR_VPS_IP lookup main prio <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>PostDown <span style=color:#f92672>=</span> ip -4 rule delete from YOUR_VPS_IP lookup main prio <span style=color:#ae81ff>18</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Peer<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>PublicKey <span style=color:#f92672>=</span> YOUR_WARP_PUBLIC_KEY
</span></span><span style=display:flex><span>AllowedIPs <span style=color:#f92672>=</span> 0.0.0.0/0, ::/0
</span></span><span style=display:flex><span>Endpoint <span style=color:#f92672>=</span> engage.cloudflareclient.com:2408
</span></span></code></pre></div><h3 id=43-start-warp>4.3 Start Warp<a hidden class=anchor aria-hidden=true href=#43-start-warp>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo wg-quick up wgcf
</span></span><span style=display:flex><span>sudo systemctl enable wg-quick@wgcf
</span></span><span style=display:flex><span>sudo wg
</span></span></code></pre></div><blockquote><p>üí° Tip : Ensure VPS traffic routing works properly after enabling Warp.</p></blockquote><hr><h2 id=5-fail2ban-module>5. Fail2Ban Module<a hidden class=anchor aria-hidden=true href=#5-fail2ban-module>#</a></h2><h3 id=51-install-fail2ban>5.1 Install Fail2Ban<a hidden class=anchor aria-hidden=true href=#51-install-fail2ban>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install -y fail2ban
</span></span></code></pre></div><h3 id=52-enable-and-start>5.2 Enable and Start<a hidden class=anchor aria-hidden=true href=#52-enable-and-start>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl enable fail2ban
</span></span><span style=display:flex><span>sudo systemctl start fail2ban
</span></span></code></pre></div><blockquote><p>üí° Tip : Combine with Nginx rate limiting for extra security.</p></blockquote><hr><h2 id=6-client-configuration-v2rayn--v2rayng>6. Client Configuration (v2rayN / v2rayNG)<a hidden class=anchor aria-hidden=true href=#6-client-configuration-v2rayn--v2rayng>#</a></h2><table><thead><tr><th>Field</th><th>Value</th><th>Remark</th></tr></thead><tbody><tr><td>Address</td><td>yourdomain.com</td><td>Your VPS domain</td></tr><tr><td>Port</td><td>443</td><td>Nginx TLS</td></tr><tr><td>UUID</td><td>YOUR_UUID</td><td>Generated in the setup</td></tr><tr><td>Encryption</td><td>none (VLESS)</td><td>TLS handled by Nginx</td></tr><tr><td>Transport</td><td>WebSocket</td><td>WebSocket over TLS</td></tr><tr><td>Path</td><td><code>/ws/8f3a7b2c9d</code></td><td>Randomized path</td></tr><tr><td>TLS</td><td>Enabled</td><td>Must match server</td></tr><tr><td>Host (SNI)</td><td>yourdomain.com</td><td>Server Name Indication</td></tr></tbody></table><p><strong>VLESS Link Example</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vless://YOUR_UUID@yourdomain.com:443?encryption<span style=color:#f92672>=</span>none&amp;security<span style=color:#f92672>=</span>tls&amp;type<span style=color:#f92672>=</span>ws&amp;host<span style=color:#f92672>=</span>yourdomain.com&amp;path<span style=color:#f92672>=</span>%2Fws%2F8f3a7b2c9d#VLESS-CDN
</span></span></code></pre></div><blockquote><p>üí° Tip : <code>%2F</code> is URL-encoded <code>/</code> for WebSocket path.</p></blockquote><hr><h2 id=7-security-and-optimization-tips>7. Security and Optimization Tips<a hidden class=anchor aria-hidden=true href=#7-security-and-optimization-tips>#</a></h2><ol><li>Use a <strong>random WebSocket path</strong> for stealth.</li><li>Keep <strong>Nginx default site</strong> for cover traffic.</li><li>Always set <strong>Cloudflare SSL to Full (Strict)</strong>.</li><li>Enable <strong>Fail2Ban</strong> and <strong>rate limiting</strong> to block scanners.</li><li>Regularly update VPS and packages:</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt upgrade -y
</span></span></code></pre></div><ol start=6><li>Set v2ray <code>loglevel</code> to <code>warning</code> to reduce I/O load.</li><li>Never expose port <code>10000</code> directly to the Internet.</li><li>Review Warp routing to ensure it does not interfere with VPS traffic.</li></ol><hr><h2 id=8-backup--rollback>8. Backup & Rollback<a hidden class=anchor aria-hidden=true href=#8-backup--rollback>#</a></h2><p>Before making any major configuration changes, always back up your existing files.<br>This ensures you can restore your setup quickly if something goes wrong.</p><h3 id=81-backup-important-configurations>8.1 Backup Important Configurations<a hidden class=anchor aria-hidden=true href=#81-backup-important-configurations>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /root/backup/v2ray
</span></span><span style=display:flex><span>sudo mkdir -p /root/backup/nginx
</span></span><span style=display:flex><span>sudo mkdir -p /root/backup/wireguard
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp /usr/local/etc/v2ray/config.json /root/backup/v2ray/config.json.bak
</span></span><span style=display:flex><span>sudo cp /etc/nginx/sites-available/default /root/backup/nginx/default.bak
</span></span><span style=display:flex><span>sudo cp /etc/wireguard/wgcf.conf /root/backup/wireguard/wgcf.conf.bak
</span></span></code></pre></div><blockquote><p>üí° Tip : You can also back up certificates and keys:</p></blockquote><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp -r /etc/nginx/ssl /root/backup/nginx-ssl/
</span></span></code></pre></div><h3 id=82-restore-from-backup>8.2 Restore from Backup<a hidden class=anchor aria-hidden=true href=#82-restore-from-backup>#</a></h3><p>If configuration errors occur, you can restore quickly:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp /root/backup/v2ray/config.json.bak /usr/local/etc/v2ray/config.json
</span></span><span style=display:flex><span>sudo cp /root/backup/nginx/default.bak /etc/nginx/sites-available/default
</span></span><span style=display:flex><span>sudo cp /root/backup/wireguard/wgcf.conf.bak /etc/wireguard/wgcf.conf
</span></span><span style=display:flex><span>sudo systemctl restart nginx
</span></span><span style=display:flex><span>sudo systemctl restart v2ray
</span></span><span style=display:flex><span>sudo systemctl restart wg-quick@wgcf
</span></span></code></pre></div><blockquote><p>üí° Tip : Always restart related services after restoring configuration files.</p></blockquote><hr><h2 id=9-troubleshooting>9. Troubleshooting<a hidden class=anchor aria-hidden=true href=#9-troubleshooting>#</a></h2><p>Even with a perfect setup, issues may occur. Here are common problems and how to fix them.</p><h3 id=91-v2ray-not-starting>9.1 V2ray Not Starting<a hidden class=anchor aria-hidden=true href=#91-v2ray-not-starting>#</a></h3><p>Check V2ray service status:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl status v2ray
</span></span></code></pre></div><p>If errors appear, check logs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo journalctl -u v2ray --no-pager -n <span style=color:#ae81ff>50</span>
</span></span></code></pre></div><p><strong>Common causes</strong>:</p><ul><li>Invalid JSON format in <code>config.json</code></li><li>Wrong UUID or path mismatch</li><li>Nginx proxy port not matching V2ray inbound</li></ul><h3 id=92-nginx-fails-to-reload>9.2 Nginx Fails to Reload<a hidden class=anchor aria-hidden=true href=#92-nginx-fails-to-reload>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nginx -t
</span></span></code></pre></div><p>If syntax errors exist, fix them before restarting:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl reload nginx
</span></span></code></pre></div><h3 id=93-tls-certificate-errors>9.3 TLS Certificate Errors<a hidden class=anchor aria-hidden=true href=#93-tls-certificate-errors>#</a></h3><p>Check certificate paths in Nginx:</p><ul><li><code>/etc/nginx/ssl/yourdomain.crt</code></li><li><code>/etc/nginx/ssl/yourdomain.key</code></li></ul><p>If expired or missing, reissue with acme.sh:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>acme.sh --renew -d yourdomain.com --force
</span></span><span style=display:flex><span>sudo systemctl reload nginx
</span></span></code></pre></div><h3 id=94-warp-wireguard-connectivity-issues>9.4 Warp (WireGuard) Connectivity Issues<a hidden class=anchor aria-hidden=true href=#94-warp-wireguard-connectivity-issues>#</a></h3><p>Check WireGuard status:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo wg
</span></span><span style=display:flex><span>sudo systemctl status wg-quick@wgcf
</span></span></code></pre></div><p>If traffic does not route properly:</p><ul><li>Verify <code>AllowedIPs</code> include <code>0.0.0.0/0, ::/0</code></li><li>Ensure correct endpoint: <code>engage.cloudflareclient.com:2408</code></li><li>Restart Warp:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo wg-quick down wgcf
</span></span><span style=display:flex><span>sudo wg-quick up wgcf
</span></span></code></pre></div><h3 id=95-cloudflare-configuration-errors>9.5 Cloudflare Configuration Errors<a hidden class=anchor aria-hidden=true href=#95-cloudflare-configuration-errors>#</a></h3><p>If HTTPS or CDN is not working:</p><ul><li>Confirm DNS proxy (orange cloud) is enabled.</li><li>SSL/TLS mode must be <strong>Full (Strict)</strong>.</li><li>Ensure Nginx is serving port 443 correctly.</li><li>Use <code>curl -Iv https://yourdomain.com</code> to check SSL response.</li></ul><h3 id=96-client-connection-fails>9.6 Client Connection Fails<a hidden class=anchor aria-hidden=true href=#96-client-connection-fails>#</a></h3><ul><li>Verify your WebSocket path <code>/ws/xxxxxx</code> matches the server config.</li><li>Ensure VLESS link matches UUID and domain.</li><li>Test using direct IP to rule out DNS issues.</li><li>Disable CDN temporarily to debug connectivity.</li></ul><blockquote><p>üí° Tip : Always check logs in both <strong>V2ray server</strong> and <strong>Nginx</strong> for real-time clues.</p></blockquote><hr></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://liftctrl.github.io/>LiftCtrl</a></span> ¬∑
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>